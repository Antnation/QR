<script>
  document.getElementById('generateBtn').addEventListener('click', function () {
    const urlInput = document.getElementById('urlInput').value.trim();
    const qrContainer = document.getElementById('qrContainer');

    // Validate URL input
    if (!urlInput) {
      alert("Please enter a URL.");
      return;
    }

    // Show loading message
    qrContainer.innerHTML = '<p id="loadingMessage" class="text-muted">Generating QR Code...</p>';

    // Replace the local endpoint with your API Gateway endpoint.
    const baseApiUrl = "https://zzalhml3lf.execute-api.us-east-2.amazonaws.com/Prod/generate?url=";
    const apiUrl = `${baseApiUrl}${encodeURIComponent(urlInput)}`;

    fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error("Network response was not ok.");
        }
        return response.json();
      })
      .then(data => {
        if (!data.qr_code) {
          throw new Error("QR code not returned from the server.");
        }
        // Create an image element and set its source to the base64 string
        const img = document.createElement('img');
        img.src = `data:image/png;base64,${data.qr_code}`;
        img.alt = "QR Code";
        img.className = "img-fluid";

        // Clear the container and display the QR code image
        qrContainer.innerHTML = "";
        qrContainer.appendChild(img);
      })
      .catch(error => {
        qrContainer.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
        console.error("Error generating QR code:", error);
      });
  });
</script>
